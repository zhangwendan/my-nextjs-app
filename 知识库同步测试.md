# 🔍 知识库同步测试指南

## 问题诊断步骤

### 第一步：检查调试信息

1. **打开浏览器开发者工具** (F12)
2. **切换到 Console 选项卡**
3. **打开设置界面** (密码：`zwd155155`)
4. **开启全局同步**
5. **观察控制台输出** - 应该看到类似：
   ```
   🔄 开始从服务器同步设置...
   📥 服务器设置: {hasApiKey: true, knowledgeFileCount: 0, ...}
   ✅ 设置同步完成
   ```

### 第二步：上传知识库文件

1. **在知识库区域上传文件**
2. **观察同步状态面板** - 应该显示文件数量
3. **点击"立即推送"按钮**
4. **检查控制台** - 应该看到：
   ```
   📤 推送设置到服务器: {knowledgeFileCount: 1, knowledgeFiles: ["filename.txt"]}
   ✅ 设置推送成功
   ```

### 第三步：测试其他设备同步

1. **在另一台电脑/浏览器打开网站**
2. **打开设置界面**
3. **开启全局同步开关**
4. **点击"拉取最新"按钮**
5. **检查知识库区域** - 应该显示文件

### 第四步：调试API接口

访问调试接口查看服务器状态：
- 打开：http://localhost:3000/api/settings/debug
- 检查 `knowledgeFileCount` 和 `knowledgeFiles` 字段

## 常见问题解决

### 🚨 如果知识库不同步：

#### 1. 检查浏览器控制台错误
- 打开 F12 → Console
- 查看是否有红色错误信息

#### 2. 检查网络请求
- F12 → Network 选项卡
- 查看 `/api/settings` 的请求和响应

#### 3. 强制重新同步
- 点击"立即推送"按钮
- 然后点击"拉取最新"按钮

#### 4. 重启服务器
- 知识库存储在内存中，重启会清空
- 重新上传文件并推送

### 🔧 调试技巧

1. **查看同步状态面板**
   - 显示当前知识库文件数量
   - 显示文件名称和大小

2. **使用调试按钮**
   - "拉取最新" - 从服务器获取设置
   - "立即推送" - 推送当前设置到服务器

3. **检查服务器状态**
   - 访问：http://localhost:3000/api/settings/debug
   - 查看完整的服务器设置

## 🎯 测试清单

- [ ] 上传知识库文件
- [ ] 开启全局同步
- [ ] 点击"立即推送"
- [ ] 控制台显示推送成功
- [ ] 另一设备开启同步
- [ ] 点击"拉取最新"
- [ ] 知识库文件出现在列表中
- [ ] 可以正常使用知识库聊天

## 💡 如果还是不工作

请提供以下信息：
1. 浏览器控制台的完整错误信息
2. 调试接口的返回结果
3. 同步状态面板显示的内容
4. 具体的操作步骤

这将帮助我们快速定位问题！ 